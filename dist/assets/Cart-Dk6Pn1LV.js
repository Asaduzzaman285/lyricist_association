import{r as o,u as A,j as e,c as q,d as B,A as H,e as F,f as G,C as R,g as O,N as J,B as T,F as r}from"./index-DbHJo27X.js";const D=B("h4");D.displayName="DivStyledAsH4";const I=o.forwardRef(({className:n,bsPrefix:l,as:h=D,...d},x)=>(l=A(l,"alert-heading"),e.jsx(h,{ref:x,className:q(n,l),...d})));I.displayName="AlertHeading";const L=o.forwardRef(({className:n,bsPrefix:l,as:h=H,...d},x)=>(l=A(l,"alert-link"),e.jsx(h,{ref:x,className:q(n,l),...d})));L.displayName="AlertLink";const P=o.forwardRef((n,l)=>{const{bsPrefix:h,show:d=!0,closeLabel:x="Close alert",closeVariant:w,className:i,children:N,variant:v="primary",onClose:j,dismissible:C,transition:m=O,...S}=F(n,{show:"onClose"}),y=A(h,"alert"),g=G(u=>{j&&j(!1,u)}),p=m===!0?O:m,f=e.jsxs("div",{role:"alert",...p?void 0:S,ref:l,className:q(i,y,v&&`${y}-${v}`,C&&`${y}-dismissible`),children:[C&&e.jsx(R,{onClick:g,"aria-label":x,variant:w}),N]});return p?e.jsx(p,{unmountOnExit:!0,...S,ref:void 0,in:d,children:f}):d?f:null});P.displayName="Alert";const _=Object.assign(P,{Link:L,Heading:I}),Q=()=>{const[n,l]=o.useState([]),[h,d]=o.useState([]),[x,w]=o.useState([]),[i,N]=o.useState({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),[v,j]=o.useState(!1),[C,m]=o.useState(!1);o.useEffect(()=>{const s=JSON.parse(localStorage.getItem("cart"))||[];l(s),S(),s.length>0&&y(s.map(a=>a.id))},[]);const S=async()=>{try{const a=await(await fetch("https://lyricistapi.wineds.com/api/v1/cart/payment-methods")).json();a.status==="success"&&d(a.data)}catch(s){console.error("Error fetching payment methods:",s)}},y=async s=>{try{const a=s.map((b,k)=>`product_ids[${k}]=${b}`).join("&"),c=await(await fetch(`https://lyricistapi.wineds.com/api/v1/cart/products-data?${a}`)).json();c.status==="success"&&w(c.data)}catch(a){console.error("Error fetching product data:",a)}},g=()=>n.reduce((s,a)=>s+parseFloat(a.price)*(a.quantity||1),0),p=()=>80,f=()=>g()+p(),u=s=>{const{name:a,value:t}=s.target;N({...i,[a]:t})},M=async s=>{s.preventDefault();const a={name:i.name,email:i.email,phone:i.phone,shipping_address:i.shippingAddress,payment_method_id:parseInt(i.paymentMethod),order_detail:n.map(t=>({product_id:t.id,price:parseFloat(t.price),qty:t.quantity||1,total:t.price*(t.quantity||1)})),sub_total:g(),delivery_charge:p(),total:f()};try{const c=await(await fetch("https://lyricistapi.wineds.com/api/v1/cart/order-placement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();c.status==="success"?(console.log("Order placed successfully:",c),l([]),N({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),localStorage.removeItem("cart"),j(!0),setTimeout(()=>{j(!1),window.location.href="/"},3e3)):(console.error("Error placing order:",c),m(!0),setTimeout(()=>{m(!1)},3e3))}catch(t){console.error("Error placing order:",t),m(!0),setTimeout(()=>{m(!1)},3e3)}},$=s=>{const a=n.filter((t,c)=>c!==s);l(a),localStorage.setItem("cart",JSON.stringify(a))},E=(s,a)=>{const t=[...n],c=t[s];c.quantity||(c.quantity=1);const b=c.quantity+a;b>0&&(c.quantity=b,l(t),localStorage.setItem("cart",JSON.stringify(t)))};return e.jsxs("div",{children:[e.jsx(J,{cart:n}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",style:{minHeight:"100vh"},children:[e.jsx("h1",{className:"text-start my-4 text-light",children:e.jsx("span",{className:"typograph-text fs-2",children:"Shopping Cart"})}),v&&e.jsx(_,{variant:"success",onClose:()=>j(!1),dismissible:!0,children:"Order placed successfully!"}),C&&e.jsx(_,{variant:"danger",onClose:()=>m(!1),dismissible:!0,children:"Error placing order. Please try again."}),e.jsx("div",{className:"cart-list",children:n.map((s,a)=>{var t;return e.jsxs("div",{className:"cart-item d-flex",children:[e.jsxs("div",{className:"image-section position-relative",children:[s.isOnSale&&e.jsx("div",{className:"super-deal-badge text-light",children:"Super Deal"}),e.jsx("img",{src:`https://lyricistadminapi.wineds.com${s.file_path}`,alt:s.name,className:"cart-image",style:{width:"100px"}})]}),e.jsxs("div",{className:"details-section text-start text-light fs-3",children:[e.jsx("h2",{className:"card-title ",children:s.name}),e.jsxs("h5",{children:["By ",(t=s.member)==null?void 0:t.name]}),e.jsxs("p",{className:"card-text mt-3 text-start text-danger",children:[s.price," BDT Only"]})]}),e.jsxs("div",{className:"actions-section d-flex flex-column justify-content-between",children:[e.jsx(T,{variant:"link",className:"text-danger delete-btn",onClick:()=>$(a),children:e.jsx("i",{className:"fas fa-trash"})}),e.jsxs("div",{className:"counter-section d-flex align-items-center text-light",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>E(a,-1),children:"-"}),e.jsx("span",{className:"mx-3",children:s.quantity||1}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>E(a,1),children:"+"})]})]})]},a)})}),n.length>0&&e.jsxs(r,{onSubmit:M,className:"user-info-form mt-4 p-4",children:[e.jsx("h3",{className:"mb-4",children:"Shipping Information"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Name"}),e.jsx(r.Control,{type:"text",name:"name",value:i.name,onChange:u,required:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Phone"}),e.jsx(r.Control,{type:"tel",name:"phone",value:i.phone,onChange:u,required:!0})]})})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Email"}),e.jsx(r.Control,{type:"email",name:"email",value:i.email,onChange:u,required:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Shipping Address"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"shippingAddress",value:i.shippingAddress,onChange:u,required:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Payment Method"}),e.jsxs(r.Select,{name:"paymentMethod",value:i.paymentMethod,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Payment Method"}),h.map(s=>e.jsx("option",{value:s.id,className:"bg-dark text-light",children:s.payment_method},s.id))]})]}),e.jsx(T,{variant:"primary",className:"w-100 mt-4",type:"submit",onClick:M,disabled:n.length===0,children:"Place Order"})]})]}),n.length>0&&e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"checkout-summary mt-4",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[g()," TK."]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsxs("span",{children:[p()," TK."]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[f()," TK."]})]})]})})]})})]})};export{Q as default};
