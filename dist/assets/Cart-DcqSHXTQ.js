import{r as p,b as w,j as e,N as P,B as j,F as n,S as N}from"./index-CfcPt9sK.js";const M="/assets/emptycart-C68bvKV1.png",T=()=>e.jsxs("div",{className:"empty-cart",children:[e.jsx("img",{src:M,alt:"Empty Cart"}),e.jsx("h2",{style:{color:"red"},children:"Your Cart is Empty!"}),e.jsx("p",{children:"Looks like you haven't made order yet."}),e.jsx(j,{variant:"primary",href:"/merchandise",className:"continue-shopping",children:"Continue to Shopping"})]}),D=({book:a,onRemove:i,onQuantityChange:d,index:l})=>{var h;const m=o=>{(a.quantity||1)+o>0&&d(l,o)};return e.jsx("div",{className:"cart-item",children:e.jsxs("div",{className:"cart-item-content",children:[e.jsxs("div",{className:"cart-item-image",children:[a.isOnSale&&e.jsx("div",{className:"super-deal-badge text-light",children:"Super Deal"}),e.jsx("img",{src:`https://adminapi.lyricistsassociationbd.com${a.file_path}`,alt:a.name})]}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h2",{className:"cart-item-title",children:a.name}),e.jsxs("h6",{className:"cart-item-author",children:["By ",e.jsx("span",{children:(h=a.member)==null?void 0:h.name})]}),e.jsxs("p",{className:"cart-item-price",children:[a.price," BDT Only"]})]}),e.jsxs("div",{className:"cart-item-actions",children:[e.jsx(j,{variant:"link",className:"delete-btn",onClick:()=>i(l),children:e.jsx("i",{className:"fas fa-trash"})}),e.jsxs("div",{className:"quantity-controls",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>m(-1),children:"-"}),e.jsx("span",{className:"mx-3",children:a.quantity||1}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>m(1),children:"+"})]})]})]})})},I=({subtotal:a,deliveryCharge:i,total:d})=>e.jsxs("div",{className:"order-summary",children:[e.jsx("h2",{className:"text-dark",children:"Order Summary"}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[a," TK."]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsxs("span",{children:[i," TK."]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[d," TK."]})]})]}),A=({userInfo:a,paymentMethods:i,onSubmit:d,onChange:l})=>e.jsxs(n,{onSubmit:d,className:"shipping-form",children:[e.jsx("h3",{children:"Shipping Information"}),e.jsxs("div",{className:"form-row ",children:[e.jsxs(n.Group,{className:"form-group",children:[e.jsx(n.Label,{children:"Name"}),e.jsx(n.Control,{type:"text",name:"name",value:a.name,onChange:l,required:!0,className:"form-control"})]}),e.jsxs(n.Group,{className:"form-group",children:[e.jsx(n.Label,{children:"Phone"}),e.jsx(n.Control,{type:"tel",name:"phone",value:a.phone,onChange:l,required:!0,className:"form-control"})]})]}),e.jsxs(n.Group,{className:"form-group",children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{type:"email",name:"email",value:a.email,onChange:l,required:!0,className:"form-control"})]}),e.jsxs(n.Group,{className:"form-group",children:[e.jsx(n.Label,{children:"Shipping Address"}),e.jsx(n.Control,{as:"textarea",rows:3,name:"shippingAddress",value:a.shippingAddress,onChange:l,required:!0,className:"form-control"})]}),e.jsxs(n.Group,{className:"form-group",children:[e.jsx(n.Label,{children:"Payment Method"}),e.jsxs(n.Select,{name:"paymentMethod",value:a.paymentMethod,onChange:l,required:!0,className:"form-select",children:[e.jsx("option",{value:"",children:"Select Payment Method"}),i.map(m=>e.jsx("option",{value:m.id,className:"bg-dark text-light",children:m.payment_method},m.id))]})]}),e.jsx(j,{variant:"primary",type:"submit",className:"submit-button",style:{backgroundColor:"red"},children:"Place Order"})]}),F=()=>{const[a,i]=p.useState([]),[d,l]=p.useState([]),[m,h]=p.useState([]),[o,u]=p.useState({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),v=w();p.useEffect(()=>{const t=JSON.parse(localStorage.getItem("cart"))||[];i(t),f(),t.length>0&&S(t.map(s=>s.id))},[]);const f=p.useCallback(async()=>{try{const s=await(await fetch("https://api.lyricistsassociationbd.com/api/v1/cart/payment-methods")).json();s.status==="success"&&l(s.data)}catch(t){console.error("Error fetching payment methods:",t)}},[]),S=p.useCallback(async t=>{try{const s=t.map((_,E)=>`product_ids[${E}]=${_}`).join("&"),c=await(await fetch(`https://api.lyricistsassociationbd.com/api/v1/cart/products-data?${s}`)).json();c.status==="success"&&h(c.data)}catch(s){console.error("Error fetching product data:",s)}},[]),x=()=>a.reduce((t,s)=>t+parseFloat(s.price)*(s.quantity||1),0),y=()=>80,g=()=>x()+y(),b=t=>{const{name:s,value:r}=t.target;u(c=>({...c,[s]:r}))},C=async t=>{t.preventDefault();const s={name:o.name,email:o.email,phone:o.phone,shipping_address:o.shippingAddress,payment_method_id:parseInt(o.paymentMethod),order_detail:a.map(r=>({product_id:r.id,price:parseFloat(r.price),qty:r.quantity||1,total:r.price*(r.quantity||1)})),sub_total:x(),delivery_charge:y(),total:g()};try{const c=await(await fetch("https://api.lyricistsassociationbd.com/api/v1/cart/order-placement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();c.status==="success"?(i([]),u({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),localStorage.removeItem("cart"),v("/tracker?order=success&order_id="+c.data.order_number)):N.fire({title:"Error placing order",text:"Please try again.",icon:"error",confirmButtonText:"OK"})}catch(r){console.error("Error placing order:",r),N.fire({title:"Error placing order",text:"Please try again.",icon:"error",confirmButtonText:"OK"})}},q=t=>{const s=a.filter((r,c)=>c!==t);i(s),localStorage.setItem("cart",JSON.stringify(s))},O=(t,s)=>{const r=[...a],c=r[t];c.quantity||(c.quantity=1),c.quantity+=s,i(r),localStorage.setItem("cart",JSON.stringify(r))};return e.jsxs("div",{className:"cart-page",children:[e.jsx(P,{cart:a}),e.jsxs("div",{className:"cart-container",children:[e.jsx("h1",{className:"text-start my-4",children:e.jsx("span",{className:"typograph-text fs-2",children:"Shopping Cart"})}),e.jsx("div",{className:"cart-content",children:a.length===0?e.jsx(T,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-main",children:[e.jsxs("div",{className:"cart-items",children:[e.jsx("h4",{style:{color:"rgba(255, 149, 0, 1)"},children:"Order Items"}),a.map((t,s)=>e.jsx(D,{book:t,index:s,onRemove:q,onQuantityChange:O},s))]}),e.jsx("div",{className:"order-summary-container",children:e.jsx(I,{subtotal:x(),deliveryCharge:y(),total:g()})})]}),e.jsx("div",{className:"shipping-form-container",children:e.jsx(A,{userInfo:o,paymentMethods:d,onSubmit:C,onChange:b})})]})})]})]})};export{F as default};
