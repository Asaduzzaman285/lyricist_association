import{r as o,u as M,j as e,c as O,i as B,A as F,w as H,h as G,N as R}from"./index-B91iYty9.js";import{C as J,F as T,B as q}from"./Button-VlsDrXsi.js";import{F as r}from"./Form-CAUPXacL.js";import"./index-Chjiymov.js";const D=B("h4");D.displayName="DivStyledAsH4";const I=o.forwardRef(({className:n,bsPrefix:i,as:h=D,...d},x)=>(i=M(i,"alert-heading"),e.jsx(h,{ref:x,className:O(n,i),...d})));I.displayName="AlertHeading";const L=o.forwardRef(({className:n,bsPrefix:i,as:h=F,...d},x)=>(i=M(i,"alert-link"),e.jsx(h,{ref:x,className:O(n,i),...d})));L.displayName="AlertLink";const P=o.forwardRef((n,i)=>{const{bsPrefix:h,show:d=!0,closeLabel:x="Close alert",closeVariant:w,className:l,children:N,variant:v="primary",onClose:j,dismissible:C,transition:m=T,...S}=H(n,{show:"onClose"}),y=M(h,"alert"),g=G(u=>{j&&j(!1,u)}),p=m===!0?T:m,f=e.jsxs("div",{role:"alert",...p?void 0:S,ref:i,className:O(l,y,v&&`${y}-${v}`,C&&`${y}-dismissible`),children:[C&&e.jsx(J,{onClick:g,"aria-label":x,variant:w}),N]});return p?e.jsx(p,{unmountOnExit:!0,...S,ref:void 0,in:d,children:f}):d?f:null});P.displayName="Alert";const _=Object.assign(P,{Link:L,Heading:I}),W=()=>{const[n,i]=o.useState([]),[h,d]=o.useState([]),[x,w]=o.useState([]),[l,N]=o.useState({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),[v,j]=o.useState(!1),[C,m]=o.useState(!1);o.useEffect(()=>{const s=JSON.parse(localStorage.getItem("cart"))||[];i(s),S(),s.length>0&&y(s.map(a=>a.id))},[]);const S=async()=>{try{const a=await(await fetch("https://lyricistapi.wineds.com/api/v1/cart/payment-methods")).json();a.status==="success"&&d(a.data)}catch(s){console.error("Error fetching payment methods:",s)}},y=async s=>{try{const a=s.map((b,$)=>`product_ids[${$}]=${b}`).join("&"),c=await(await fetch(`https://lyricistapi.wineds.com/api/v1/cart/products-data?${a}`)).json();c.status==="success"&&w(c.data)}catch(a){console.error("Error fetching product data:",a)}},g=()=>n.reduce((s,a)=>s+parseFloat(a.price)*(a.quantity||1),0),p=()=>80,f=()=>g()+p(),u=s=>{const{name:a,value:t}=s.target;N({...l,[a]:t})},A=async s=>{s.preventDefault();const a={name:l.name,email:l.email,phone:l.phone,shipping_address:l.shippingAddress,payment_method_id:parseInt(l.paymentMethod),order_detail:n.map(t=>({product_id:t.id,price:parseFloat(t.price),qty:t.quantity||1,total:t.price*(t.quantity||1)})),sub_total:g(),delivery_charge:p(),total:f()};try{const c=await(await fetch("https://lyricistapi.wineds.com/api/v1/cart/order-placement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();c.status==="success"?(console.log("Order placed successfully:",c),i([]),N({name:"",phone:"",email:"",shippingAddress:"",paymentMethod:""}),localStorage.removeItem("cart"),j(!0),setTimeout(()=>{j(!1),window.location.reload()},3e3)):(console.error("Error placing order:",c),m(!0),setTimeout(()=>{m(!1)},3e3))}catch(t){console.error("Error placing order:",t),m(!0),setTimeout(()=>{m(!1)},3e3)}},k=s=>{const a=n.filter((t,c)=>c!==s);i(a),localStorage.setItem("cart",JSON.stringify(a))},E=(s,a)=>{const t=[...n],c=t[s];c.quantity||(c.quantity=1);const b=c.quantity+a;b>0&&(c.quantity=b,i(t),localStorage.setItem("cart",JSON.stringify(t)))};return e.jsxs("div",{children:[e.jsx(R,{}),e.jsx("div",{className:"container-fluid ",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",style:{minHeight:"100vh"},children:[e.jsx("h1",{className:"text-center my-4 text-light",children:"Shopping Cart"}),v&&e.jsx(_,{variant:"success",onClose:()=>j(!1),dismissible:!0,children:"Order placed successfully!"}),C&&e.jsx(_,{variant:"danger",onClose:()=>m(!1),dismissible:!0,children:"Error placing order. Please try again."}),e.jsx("div",{className:"cart-list",children:n.map((s,a)=>{var t;return e.jsxs("div",{className:"cart-item d-flex",children:[e.jsxs("div",{className:"image-section position-relative",children:[s.isOnSale&&e.jsx("div",{className:"super-deal-badge text-light",children:"Super Deal"}),e.jsx("img",{src:`https://lyricistadminapi.wineds.com${s.file_path}`,alt:s.name,className:"cart-image"})]}),e.jsxs("div",{className:"details-section text-start text-light",children:[e.jsx("h2",{className:"card-title",children:s.name}),e.jsxs("h5",{children:["By ",(t=s.member)==null?void 0:t.name]}),e.jsxs("p",{className:"card-text mt-3 text-start text-danger",children:[s.price," BDT Only"]})]}),e.jsxs("div",{className:"actions-section d-flex flex-column justify-content-between",children:[e.jsx(q,{variant:"link",className:"text-danger delete-btn",onClick:()=>k(a),children:e.jsx("i",{className:"fas fa-trash"})}),e.jsxs("div",{className:"counter-section d-flex align-items-center text-light",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>E(a,-1),children:"-"}),e.jsx("span",{className:"mx-3",children:s.quantity||1}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>E(a,1),children:"+"})]})]})]},a)})}),n.length>0&&e.jsxs(r,{onSubmit:A,className:"user-info-form mt-4 p-4",children:[e.jsx("h3",{className:"mb-4",children:"Shipping Information"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Name"}),e.jsx(r.Control,{type:"text",name:"name",value:l.name,onChange:u,required:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Phone"}),e.jsx(r.Control,{type:"tel",name:"phone",value:l.phone,onChange:u,required:!0})]})})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Email"}),e.jsx(r.Control,{type:"email",name:"email",value:l.email,onChange:u,required:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Shipping Address"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"shippingAddress",value:l.shippingAddress,onChange:u,required:!0})]}),e.jsxs(r.Group,{className:"mb-3 ",children:[e.jsx(r.Label,{children:"Payment Method"}),e.jsxs(r.Select,{name:"paymentMethod",value:l.paymentMethod,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Payment Method"}),h.map(s=>e.jsx("option",{value:s.id,className:"bg-dark text-light",children:s.payment_method},s.id))]})]}),e.jsx(q,{variant:"primary",className:"w-100 mt-4",type:"submit",onClick:A,disabled:n.length===0,children:"Place Order"})]})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"checkout-summary mt-4",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[g()," TK."]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsxs("span",{children:[p()," TK."]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[f()," TK."]})]}),e.jsx(q,{variant:"primary",className:"w-100 mt-4",type:"submit",onClick:A,disabled:n.length===0,children:"Place Order"})]})})]})})]})};export{W as default};
